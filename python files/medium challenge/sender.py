import socket
import Crypto
from Crypto.Cipher import AES
import hmac
import hashlib
ip_ad='10.0.2.15'
key=b'dattebayomhaaotf'
iv=b'shhhdifnivrnfhrf'
port=4030
sock=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
sock.bind(('',port))
sock.listen(1)


conn,addr=sock.accept()

print("HOST ADDRESS: ",addr)
#AES encryption
def pad(msg):
	block_size=16
	p=(block_size-len(msg))%block_size
	pd_str=p * ' '
	return msg+pd_str
aes=AES.new(key,AES.MODE_CBC,iv)
msg=input('Enter message: ')
pad_msg=pad(msg)
print(pad_msg)
ecp=aes.encrypt(pad_msg)
ha_sh=hmac.new(key,msg,hashlib.sha512)
conn.send(ha_sh.hexdigest().encode())
print(ecp)
conn.send(str(ecp))
sock.close()